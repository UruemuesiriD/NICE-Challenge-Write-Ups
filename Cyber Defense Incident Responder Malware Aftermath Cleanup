# Challenge 20 Malware Aftermath Cleanup

Details:
-

Author: Bailey Kasin
Framework Category: Protect and Defend
Specialty Area: Incident Response
Work Role: Cyber Defense Incident Responder
Task Description: Collect intrusion artifacts (e.g., source code, malware, Trojans) and use discovered data to enable mitigation of potential cyber defense incidents within the enterprise. (T0278)


Scenario:
-


>Recently, malicious activity has been discovered within our network. We need you to go through the affected systems and collect any malicious artifacts you come across. If any changes were made to the host systems due to the malware you will need to remediate the harmful effects.

Additional Information:
-

>More details and objectives about this challenge will be introduced during the challenge meeting, which will start once you begin deploying the challenge.

>You will be able to check your progress during this challenge using the check panel within the workspace once the challenge is deployed. The checks within the check panel report on the state of some or all of the required tasks within the challenge.

>Once you have completed the requested tasks, you will need to document the methodology you used with as much detail and professionalism as necessary. This should be done on the documentation tab within the workspace once the challenge is deployed. Below the main documentation section be sure to include a tagged list of applications you used to complete the challenge.

>Your username/password to access all virtual machines and services within the workspace will be the following...

'''html
Username: playerone
Password: password123
'''

>The username/password used to access the Firewall's web interface within the workspace will be the following...

'''html
Username: playerone
Password: password123
'''


Challenge Meeting note:
-

>Ashley Steele
I'm beginning to suspect Domain-Controller has somehow been compromised. We may have a serious situation on our hands.

>Ricardo Cortes
Please tell me you're joking. What sort of activity have you observed that made you come to this conclusion?

>Ashley Steele
Unfortunately, I'm being serious. I was taking a look at the traffic going through Firewall and Domain-Controller seems to be connecting frequently to an IP I don't recognize. Maybe some sort of malware on the box could be phoning home? @manderson, you were recently working on this box. What were you doing exactly?

>Mitch Anderson
All I did was update .NET so that the management software we're getting soon will be ready to go.

>Ricardo Cortes
Can you investigate the matter further, @asteele?

>Ashley Steele
I'd love to, but unfortunately I think my skills in this field are limited. Maybe @playerone could look into the situation further.

>Ricardo Cortes
Sounds like a pretty great idea! @playerone, please diagnose the situation on Domain-Controller. Once you're confident you know what's going on, submit an Incident Response report on the website hosted on Fileshare.

>Ashley Steele
You can access that form by navigating to Fileshare's IP address in a web browser from any machine in our network. You should also isolate a copy of the malware, along with any associated payload, in a folder on your desktop on Security-Desk called 'quarantine'.

>Ashley Steele
In case you want to look at the traffic coming through Firewall, remember that the username and password for the pfSense GUI are 'admin' and 'password123'.


Network Map:
-

Add Image


First Section: Correct Information in Incident Report
-

I search for *.vbs on the file explorer (you have to be on you c: drive to ensure it search all the directories in it.
Found the VB script (AIZRTdHWyQjcM.vbs) and a executable (NDP452-KB2901954-Web.exe) at two different paths

'''html
  C:\Users
	C:\Program Files\OpenSSH\home\playerone\Downloads
	C: \Users\Administrator\Downloads
'''

>	Note:
	I knew this are the malicious file because on a server you do see a .vbs and .exe files seating around
	
I opened my power shell and secure copy the file to the quarantine location on the security desk kali linux
	
  '''html
  PS C:\Users\playerone> cd ..
	PS C:\Users> cd .\Administrator\Downloads
	'''
  
	To see all the file I the directory
  
  '''html
	PS C:\Users> cd .\Administrator\Downloads> ls
	'''
  
	Secure copy the .vbs file to security desk
  
  '''html
	PS C:\Users\Administrator\Downloads> scp AIZRTdHWyQjcM.vbs playerone@172.16.20.55:~/Desktop/quarantine
	playerone@172.16.20.55's password:
	'''
  
	>Note: 
	For the .vbs file when I list directory it didn't show anything so I just copied it.
	
	Secure copy the .exe file to security desk
  
  '''html
	PS C:\Program Files\OpenSSH\home\playerone\Downloads> scp NDP452-KB2901954-Web.exe playerone@172.16.20.55:~/Desktop/quarantine
	playerone@172.16.20.55's password:
	'''
	
  
Method two:
-

>I downloaded Process Hacker (nightly build) to see the process  

		Note: it's Sems for windows
			
			Right Click the description bar and 
			Choose columns
			Then add:
				I added virus tool
				Coherence
		
>With this Proccess Hacker  I was able to locat the .exe and the path to the .vbs by observing the file that were beaconing
 

Section two: Initial Intrusion Artifact Isolated on Security-Desk
-

>On the network map the pfsense firewall IP: 172.31.2.2...
I entered that on the powerser on my windows server
		Went to Diagnostics:
		Packet capture
    I click Start;
    stopped it after an minnute
    Downloaded Capture
    Secure copy the downloaded capture using PowerShell to Security Desk where I open it with Wireshark to be able to read the capture
    
Opened with Wireshark for packet nalysis
Clicked one of the packets showing red and then opened the little dropdwonon  transsmision control protoclol hightlighted in yellow. 
Copied the source port 1421 and the soure address 172.31.2.107


Secotion 3;  Correct Information in Incident Report
-
Filled the report
Incident result sent


NICE Framework & CAE KU Mapping
-

NICE Framework KSA
• K0004. Knowledge of cybersecurity and privacy principles.
• K0005. Knowledge of cyber threats and vulnerabilities.
• K0070. Knowledge of system and application security threats and vulnerabilities (e.g., buffer overflow, mobile code, cross-site scripting, Procedural Language/Structured Query Language [PL/SQL] and injections, race conditions, covert channel, replay, return-oriented attacks, malicious code).
• K0162. Knowledge of cyber attackers (e.g., script kiddies, insider threat, non-nation state sponsored, and nation sponsored).
• K0167. Knowledge of system administration, network, and operating system hardening techniques.
• K0259. Knowledge of malware analysis concepts and methodologies.
• S0003. Skill of identifying, capturing, containing, and reporting malware.
• S0079. Skill in protecting a network against malware. (e.g., NIPS, anti-malware, restrict/prevent external devices, spam filters).
CAE Knowledge Units
• Cybersecurity Foundations
• Cybersecurity Principles
• Operating Systems Administration
• Operating Systems Concepts







